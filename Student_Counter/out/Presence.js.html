<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: Presence.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: Presence.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import * as firebase from 'firebase';
let Student = require("./Student");
let Lesson = require("./Lesson");

let namespaces = require("./namespaces").namespaces;

/** Class representing a Presence */
class Presence{
    /**
     * 
     * @param {number} studentId 
     * @param {number} lessonId 
     * @param {boolean} present 
     * @param {boolean} delay 
     */
    constructor(studentId, lessonId, present, delay){
        this.studentId = studentId;
        this.lessonId = lessonId;
        this.present = present;
        this.delay = present ? delay : false; // this check exists because: a student couldn't be late if he didn't show up
    }

    /**
     * Saves an instance of the Presence in the database, if the instance already exists updates the current instance otherwise creates a new one.
     */
    save(){
        if(this.id){
            return firebase.database().ref(namespaces.presences + this.id).update({
                studentId: this.studentId,
                lessonId: this.lessonId,
                present: this.present,
                delay: this.delay
            });
        } else {
            return new Promise((resolve, reject)=>{
                let obj = firebase.database().ref(namespaces.presences).push(this);
                this.id = obj.key;
                resolve(this.id);
            });
        }
    }

    /**
     * Updates the state os the Presence with the value passed in the param.
     * @param {boolean} isPresent 
     */
    updatePresence(isPresent){
        if(this.id){
            return firebase.database().ref(namespaces.presences + this.id).update({
                present:isPresent        
            });
        }
    }

    /**
     * Updates de value of the delay in the Presence
     * @param {boolean} isDelayed 
     */
    updateDelay(isDelayed){
        if(this.id){
            return firebase.database().ref(namespaces.presences + this.id).update({
                delay:isDelayed
            });
        }
    }

    /**
     * Deletes de Presence's instance in the database
     */
    delete(){
        firebase.database().ref(namespaces.presences + this.id).remove();
    }

    /**
     * Gets the Student of the Presence.
     */
     async getStudent(){
        return await Student.retrieve(this.studentId);
    }

    /**
     * Gets the Lesson where the Presence is being made.
     */
     async getLesson(){
        return await Lesson.retrieve(this.lessonId);
    }

    /**
     * Returns all the Presences in the database.
     */
    static all(){
        return firebase.database().ref(namespaces.presences).once("value").then(function (snapshot) {
            let presences = [];
            snapshot.forEach(function(presenceValues){
                let id = presenceValues.key;
                let delay = presenceValues.val().delay;
                let present = presenceValues.val().present;
                let lessonId = presenceValues.val().lessonId;
                let studentId = presenceValues.val().studentId;
                let presence = new Presence(studentId, lessonId, present, delay);
                presence.id = id;
                presences.push(presence);
            });
            return presences;
        }, function(error) {
            console.error(error);
        }).then(function(value) {
            return value;
        });
    }

    /**
     * Gets the Presence that has the id passed in the param.
     * @param {number} id 
     */
    static retrieve(id){
        return new Promise((resolve, reject)=>{
            firebase.database().ref(namespaces.presences + id).once('value').then(function(snapshot){
                let studentId = snapshot.val().studentId;
                let lessonId = snapshot.val().lessonId;
                let present = snapshot.val().present;
                let delay = snapshot.val().delay;
                let presence = new Presence(studentId, lessonId, present, delay);
                presence.id = id;
                resolve(presence);
            });
        });
    }
}

module.exports = Presence;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Presence.html">Presence</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Tue Jun 20 2017 05:07:33 GMT+0100 (Hora de Ver√£o de GMT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
