<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: Class.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: Class.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import * as firebase from 'firebase';
let Student = require("./Student");
let Subject = require("./Subject");
let namespaces = require("./namespaces").namespaces;

/** Class representing a Class */
class Class {
    /**
     * Creates a Class
     * @param {string} name 
     * @param {number} studentIds 
     * @param {number} subjectIds 
     */
    constructor(name, studentIds, subjectIds) {
        this.name = name;
        this.studentIds = studentIds;
        this.subjectIds = subjectIds;
    }

    /**
     * Saves an instance of the Class in the database, if the instance already exists updates the current instance
     * otherwise creates a new one.
     */
    save(){
        return firebase.database().ref(namespaces.classes + this.name).set({
            studentIds: this.studentIds,
            subjectIds: this.subjectIds
        });
    }

    /**
     * Deletes the Class's instance from the database.
     */
    delete(){
        firebase.database().ref(namespaces.classes + this.name).remove();
    }

    /**
     * Gets the Students that are in the Class.
     */
     async getStudents(){
        let array = [];
        for(let studentId of this.studentIds) {
            array.push(await Student.retrieve(studentId));
        }
        return array;
    }

    /**
     * Gets the Subjects related to this Class.
     */
     async getSubjects(){
        let array = [];
        for(let subjectId of this.subjectIds) {
            array.push(await Subject.retrieve(subjectId));
        }
        return array;
    }

    /**
     * Returns the number of registered Students in the Class.
     */
    numberOfregisteredStudentsAsync(){
        let that = this;
        return firebase.database().ref(namespaces.students).once("value").then(function (snapshot) {
            let numberStudents = 0;
            snapshot.forEach(function(student){
                if(that.studentIds.includes(student.key)){
                    numberStudents++;
                }
            });
            return numberStudents;
        }, function(error) {
            console.error(error);
        }).then(function(value) {
            return {
                name: that.name,
                numberStudents: value
            };
        });
    }

    /**
     * Returns all the Classes in the database.
     */
    static all(){
        return firebase.database().ref(namespaces.classes).once("value").then(function (snapshot) {
            let classes = [];
            snapshot.forEach(function(classValues){
                let name = classValues.key;
                let studentId = classValues.val().studentIds;
                let subjectIds = classValues.val().subjectIds;
                classes.push(new Class(name, studentId, subjectIds))
            });
            return classes;
        }, function(error) {
            console.error(error);
        }).then(function(value) {
            return value;
        });
    }

    /**
     * Gets the Class that has the name passed in the param.
     * @param {string} name
     */
    static retrieve(name){
        return new Promise((resolve, reject)=>{
            firebase.database().ref(namespaces.classes + name).once('value').then(function(snapshot){
                let studentIds = snapshot.val().studentIds;
                let subjectIds = snapshot.val().subjectIds;
                let clazz = new Class(name, studentIds, subjectIds);
                resolve(clazz);
            });
        });
    }
}

module.exports = Class;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Class.html">Class</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Tue Jun 20 2017 04:57:06 GMT+0100 (Hora de Ver√£o de GMT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
